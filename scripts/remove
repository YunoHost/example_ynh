#!/bin/bash

# See comments in install script
app=$YNH_APP_INSTANCE_NAME

# Source YunoHost helpers
source /usr/share/yunohost/helpers

# Retrieve app settings
domain=$(ynh_app_setting_get "$app" domain)

# Remove sources
# Avoid removing important directory if $app is empty or equal to 
# "/" "/var" "/var/www" "/opt" "/home" "/home/yunohost.app"
src_path=/var/www/$app
if test -z "$src_path" || [ "/var/www /opt /home/yunohost.app" =~ $src_path ]; then
	echo "Variable src_path seems incomplete, suppression of app directory cancelled." >&2
else
	sudo rm -rf $src_path
fi

# Remove nginx configuration file
sudo rm -f /etc/nginx/conf.d/$domain.d/$app.conf
# Reload nginx service
sudo service nginx reload

### PHP (remove if not used) ###
# If a dedicated php-fpm process is used:
sudo rm -f /etc/php5/fpm/pool.d/$app.conf
sudo service php5-fpm reload
### PHP end ###

### MySQL (remove if not used) ###
# If a MySQL database is used:
# # Drop MySQL database and user
# dbname=$app
# dbuser=$app
# ynh_mysql_drop_db "$dbname" || true
# ynh_mysql_drop_user "$dbuser" || true
### MySQL end ###

